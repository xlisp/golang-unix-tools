这个程序的主要作用是通过SSH协议实现本地端口转发，将远程服务器上的指定端口（如8899）映射到本地端口，从而使你能够访问远程服务器上的服务。该程序会不断监控连接情况，并定期执行健康检查（通过运行远程服务器上的`netstat`命令检查端口8899是否在监听状态）。如果连接断开，它会在5秒后自动重试，确保转发服务稳定运行。

### 功能说明：

1. **SSH连接与端口转发**：
   - 程序首先通过SSH与远程服务器建立连接，并将远程服务器上的端口（如8899）通过SSH隧道映射到本地的端口22。
   
2. **自动重连**：
   - 如果连接断开，程序会自动重新连接，避免手动干预，确保服务的持续性。

3. **健康检查**：
   - 每10秒钟，程序会通过SSH连接执行远程`netstat`命令，检查远程服务器的8899端口是否处于监听状态，以确保转发正常运行。

4. **双向数据转发**：
   - 程序通过`io.Copy`实现双向的数据转发，确保远程和本地的端口通信畅通。

### 使用PM2管理程序

为了方便在生产环境中长期运行该程序，建议使用PM2来管理和监控这个Go程序。PM2是一个强大的进程管理工具，可以在系统启动时自动启动程序，监控运行状态，并支持Windows和macOS。

#### 安装与使用步骤：

##### 1. 安装PM2

PM2是基于Node.js的工具，所以需要先安装Node.js，然后通过npm安装PM2。

**Windows与macOS下的安装命令如下：**

```bash
# 安装Node.js（如果未安装）
# 可以从Node.js官方网站下载 https://nodejs.org/
# 安装完成后，使用以下命令安装PM2

npm install pm2 -g
```

##### 2. 编译Go程序

首先确保Go环境已经安装，然后编译你的Go程序。

```bash
# 进入程序所在的目录
cd ~/golang-unix-tools

# 编译程序
go build  go_ssh_reverse_proxy.go
```

##### 3. 使用PM2管理编译后的Go程序

使用以下命令启动并管理你的Go程序：

```bash
# 启动程序并让它在后台运行
pm2 start ./go_ssh_reverse_proxy --name "ssh-forward"

# 查看程序状态
pm2 status

# 如果需要停止或重启
pm2 stop ssh-forward
pm2 restart ssh-forward
```

##### 4. 设置PM2开机自启动

你可以设置PM2让它在系统启动时自动启动你的Go程序。

```bash
# 生成启动配置
pm2 startup

# 保存当前运行的进程列表
pm2 save
```

这样，无论是Windows还是macOS，系统重启后PM2都会自动启动并管理该Go程序。

### 支持平台：

- **Windows**：可通过命令行、Powershell执行PM2，并且在系统启动时自动启动转发服务。
- **macOS**：可以通过终端使用PM2，并设置开机自动启动服务。下载地址: ![go_ssh_reverse_proxy_mac](./go_ssh_reverse_proxy_mac)

通过以上步骤，你可以在Windows和macOS上使用PM2轻松管理你的SSH端口转发程序，保证远程服务器端口的稳定访问。


